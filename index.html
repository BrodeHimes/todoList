<!DOCTYPE html>
<html>

<head>
  <title> Todo List</title>
  <style>
      body {
          display:flex ;
          flex-wrap: wrap;
          flex-direction: column;
          margin-left: 100px;
      }
      li {
          display:flex;
          justify-content: space-between;
          width: 500px;
      }
      .hidden {
          display:none;
      }

      #edit{

      }

      .inputBoxClass{
          width: 100%;
      }

       
  .pagination {
    max-width: 400px;
    min-width: 300px;
    width: 100%;
    display: block;
    margin: 0 auto;
    position: relative;
    background-color: lightgreen;
    padding: 20px;
  }
  .pagination .tableList {
      min-height: 250px;
      text-indent: 20px;
  }
  .tableList .objectBlock {
      position: relative;
      background-color: black;
      color: white;
      padding: 10px;
      margin-bottom: 10px;
  }
  .pageButton {
      border: 1px solid black;
      padding: 5px;
  }
  .clickPageNumber {
      background-color: lightgrey;
      padding: 5px;
      margin-left: 2px;
      margin-right: 2px;
  }
  .pagination-block {
    text-align: center;
    width: 100%;
  }
  .pagination-block span {
    display: inline-block;
  }
  .pagination-block .pageButton {
    background-color: grey;
    color: white;
  }
  .pagination-block span:hover {
    cursor: pointer;
  }
  .opacity {
    opacity: 0.5;
  }
  .outline-none {
    outline: none;
    user-select: none; 
  }
}

  </style>
</head>

<body>
<header> 
    <h1> My Todo List</h1>
</header>

<main> 
    <form> 
        <label for="inputBox" ></label>
        <input type="text" id="inputBox" name="inputBox" autocomplete="off">
        <button type="button" id="create">Create</button>
        <button type="button" id="clear">Clear</button>
        <button type="button" id="deleteAll">Delete All</button>
    </form>
    <section id="todoListContainer">
        <p id="noItems">You don't have any todo items</p> 
        <ol id="todoList"></ol>
    </section>
    



<div class="pagination">
    <div class="tableList" id="listingTable"></div>
    <div class="pagination-block">
      <span class="pageButton outline-none" id="button_prev">Prev</span>
      <span id="page_number" class="outline-none"></span>
      <span class="pageButton outline-none" id="button_next">Next</span>
    </div>
  </div>

   

</main>

<script>
    let inputBox = document.getElementById("inputBox");
    let create = document.getElementById("create");
    let todoList = document.getElementById("todoList");
    let noItemsMessage = document.getElementById("noItems");
    let clear = document.getElementById('clear');
    let deleteAll = document.getElementById('deleteAll');
    let todoListContainer= document.getElementById('todoListContainer');
    let todoListItemButtons = "<form><button type='button' id='edit' class='editClass'>Edit</button><button type='button'id='delete' class='deleteClass'>Delete</button></form>"




    
  // if you have any suggestion of questions, pleasse feel free to send me an email to chiholiu10@gmail.com

   function Pagination() {
      
       const objJson = Object.keys(localStorage);
       console.log(objJson);
      const prevButton = document.getElementById('button_prev');
      const nextButton = document.getElementById('button_next');
      const clickPageNumber = document.querySelectorAll('.clickPageNumber');
      
      let current_page = 1;
      let records_per_page = 5;
      
      this.init = function() {
          changePage(1);
          pageNumbers();
          selectedPage();
          clickPage();
          addEventListeners();
     }
      
      let addEventListeners = function() {
          prevButton.addEventListener('click', prevPage);
          nextButton.addEventListener('click', nextPage);   
      }
            
      let selectedPage = function() {
          let page_number = document.getElementById('page_number').getElementsByClassName('clickPageNumber'); 
          for (let i = 0; i < page_number.length; i++) {
              if (i == current_page - 1) {
                  page_number[i].style.opacity = "1.0";
              } 
              else {
                  page_number[i].style.opacity = "0.5";
              }
          }   
      }  
      
      let checkButtonOpacity = function() {
        current_page == 1 ? prevButton.classList.add('opacity') : prevButton.classList.remove('opacity');
        current_page == numPages() ? nextButton.classList.add('opacity') : nextButton.classList.remove('opacity');
      }

      let changePage = function(page) {
          const listingTable = document.getElementById('listingTable');

          if (page < 1) {
              page = 1;
          } 
          if (page > (numPages() -1)) {
              page = numPages();
          }
       
          listingTable.innerHTML = "";

          for(var i = (page -1) * records_per_page; i < (page * records_per_page) && i < objJson.length; i++) {
              listingTable.innerHTML += "<div class='objectBlock'>" + objJson[i] + "</div>";
          }
          checkButtonOpacity();
          selectedPage();
      }

      let prevPage = function() {
          if(current_page > 1) {
              current_page--;
              changePage(current_page);
          }
      }

      let nextPage = function() {
          if(current_page < numPages()) {
              current_page++;
              changePage(current_page);
          } 
      }

      let clickPage = function() {
          document.addEventListener('click', function(e) {
              if(e.target.nodeName == "SPAN" && e.target.classList.contains("clickPageNumber")) {
                  current_page = e.target.textContent;
                  changePage(current_page);
              }
          });
      }

      let pageNumbers = function() {
          let pageNumber = document.getElementById('page_number');
              pageNumber.innerHTML = "";

          for(let i = 1; i < numPages() + 1; i++) {
              pageNumber.innerHTML += "<span class='clickPageNumber'>" + i + "</span>";
          }
      }

      let numPages = function() {
          return Math.ceil(objJson.length / records_per_page);  
      }
   }
  let pagination = new Pagination();
  pagination.init();









// let turnIntoPage = ()=>{
//     if ()

// }










//localStorage

  let showCachedList = ()=>{
     if (window.localStorage.length==0){
        todoList.innerHTML = ""
     } else {
        noItemsMessage.setAttribute('class', 'hidden');
        let cachedTodoListArray = Object.keys(localStorage);

        console.log(cachedTodoListArray);
        cachedTodoListArray.forEach(item =>{
        let cachedTodoListItem = document.createElement("LI");
        cachedTodoListItem.setAttribute('class','todoListItemClass');
        cachedTodoListItem.innerHTML= item+todoListItemButtons;
        todoList.insertAdjacentElement('afterbegin',cachedTodoListItem);

         //calling edit button event handler
        let editButtonClass=document.getElementsByClassName('editClass');
        editButtonClicked(editButtonClass);

        //calling delete button event handler
        let deleteButtonClass=document.getElementsByClassName('deleteClass');
        deleteButtonClicked(deleteButtonClass, item);

        }) 
      }
    };


   
//bugs 
// unable to save 2 todolist items of same value
// on refresh, items don't stay in same order as they were put in. Seem to be in alphabetical order
      






       

  window.addEventListener('load', showCachedList);



let todoListArray = [];



//Create Event Handler
    let addTodoItem = ()=>{ 
        noItemsMessage.setAttribute('class', 'hidden');
        let itemToAdd = inputBox.value;
        let todoListItem = document.createElement("LI");
        todoListItem.setAttribute('class','todoListItemClass');
        todoListItem.innerHTML = itemToAdd+todoListItemButtons;

    
        //localStorage
        window.localStorage.setItem(itemToAdd,itemToAdd)
        todoList.insertAdjacentElement('afterbegin',todoListItem);
        
        inputBox.value="";

        //calling edit button event handler
        let todoListItemClass=document.querySelectorAll("li.todoListItemClass");
        let editButtonClass=document.getElementsByClassName('editClass');
        editButtonClicked(editButtonClass);

        //calling delete button event handler
        let deleteButtonClass=document.getElementsByClassName('deleteClass');
        deleteButtonClicked(deleteButtonClass);
        
    };

//Edit Button Event handler
    let editButtonClicked=(classToLoop)=>{
        let populateInput = function(e){
            //makes it so that ONLY the edit button clicked will turn to input
            let listItemNowInput=e.target.parentNode.parentNode;
            let originalListElement=listItemNowInput.outerHTML;
            
            listItemNowInput.innerHTML="<label for='inputBox'></label><input type=text id='inputBox' class='inputBoxClass'>";

            //calling enter click event handler
            let inputBoxClass=document.getElementsByClassName('inputBoxClass');
            enterInputClicked(inputBoxClass,listItemNowInput,originalListElement);
         }

        for(let i=0; i<classToLoop.length;i++){
         classToLoop[i].addEventListener('click',populateInput);
        }

    };

// Input box event handlers (enter, esc, focusout)
    let enterInputClicked=(classToLoop,todoListItemToEdit,originalTodoItem)=>{
        for(let i=0; i<classToLoop.length;i++){
          classToLoop[i].addEventListener('keyup',function(e){
            let inputValue=e.target.value;
            if (e.keyCode === 13) {
              todoListItemToEdit.outerHTML='<li class="todoListItemClass">'+inputValue+todoListItemButtons;


            //localStorage
              let ogTodoItemValue=originalTodoItem.replace('<li class="todoListItemClass">','');
              ogTodoItemValue=ogTodoItemValue.replace('<form><button type="button" id="edit" class="editClass">Edit</button><button type="button" id="delete" class="deleteClass">Delete</button></form></li>','');


              window.localStorage.removeItem(ogTodoItemValue);
              window.localStorage.setItem(inputValue,inputValue);

              let editButtonClass=document.getElementsByClassName('editClass');
              editButtonClicked(editButtonClass,todoListItemToEdit);

              let deleteButtonClass=document.getElementsByClassName('deleteClass');
              deleteButtonClicked(deleteButtonClass);

              } else if (e.keyCode===27){
                todoListItemToEdit.innerHTML=originalTodoItem;
                

                let editButtonClass=document.getElementsByClassName('editClass');
                editButtonClicked(editButtonClass,todoListItemToEdit);
                let deleteButtonClass=document.getElementsByClassName('deleteClass');
                deleteButtonClicked(deleteButtonClass);
              } 
          });
          classToLoop[i].addEventListener('focusout', function(){
            todoListItemToEdit.innerHTML=originalTodoItem;

            let editButtonClass=document.getElementsByClassName('editClass');
            editButtonClicked(editButtonClass,todoListItemToEdit);
            let deleteButtonClass=document.getElementsByClassName('deleteClass');
            deleteButtonClicked(deleteButtonClass);
         });
       }
   };
    
//Item Delete event handler
  let deleteButtonClicked = (classToLoop)=>{
    let deleteListItem = function(e){
    //   console.log(todoValue)
    //   console.log(todoListArray);
    //   console.log(todoListArray.indexOf(todoValue));
      

      e.target.parentNode.parentNode.remove();
      console.log (e.target.parentNode.parentNode.textContent)
        
     //remove from local storage   
    let todoValue = e.target.parentNode.parentNode.textContent.replace('EditDelete','');
    // todoValue = todoValue.slice(0,todoValue.length - 1);
     console.log(todoValue.length);
     console.log(todoValue)
    window.localStorage.removeItem(todoValue);
    

      

     
    };

    for(var i=0; i<classToLoop.length;i++){
    classToLoop[i].addEventListener('click',deleteListItem);
    }
  };

create.addEventListener("click",addTodoItem);

//Clear event handler
  let clearInput = ()=>{
   inputBox.value="";
  }
  clear.addEventListener("click", clearInput);

//Delete All event handlder
    let deleteAllItems =()=>{
        todoList.innerHTML='';
        noItemsMessage.removeAttribute('class', 'hidden'); 
        //clear cache
        window.localStorage.clear();
    }

    deleteAll.addEventListener('click',deleteAllItems);

</script>
  
</body>

</html>